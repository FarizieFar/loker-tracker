

{% extends 'base-sidebar.html' %}

{% block title %}Tambah Lamaran - Loker Tracker{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Dashboard</a></li>
    <li class="breadcrumb-item active">Tambah Lamaran</li>
{% endblock %}

{% block content %}


<!-- Clean Header Section -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="card-title mb-1">
                    <i class="fas fa-plus-circle me-2"></i>
                    Tambah Lamaran Kerja
                </h1>
                <p class="card-subtitle mb-0 opacity-75">
                    Catat informasi lamaran kerja baru Anda
                </p>
            </div>
            <div>
                <a href="/" class="btn btn-light">
                    <i class="fas fa-arrow-left me-2"></i>Kembali
                </a>
            </div>
        </div>
    </div>
</div>



<!-- Clean Form Card -->
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-1">
                    <i class="fas fa-building me-2"></i>
                    Informasi Lamaran Kerja
                </h5>
                <p class="card-subtitle mb-0">
                    Lengkapi informasi berikut untuk mencatat lamaran kerja baru
                </p>
            </div>
            
            <div class="card-body">

                <form method="post" enctype="multipart/form-data">

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="company_name" class="form-label text-muted fw-medium">
                                <i class="fas fa-building me-1"></i>Nama Perusahaan
                            </label>
                            <input type="text" class="form-control" id="company_name" name="company_name" 
                                   placeholder="Masukkan nama perusahaan" required>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="position" class="form-label text-muted fw-medium">
                                <i class="fas fa-user-tie me-1"></i>Posisi yang Dilamar
                            </label>
                            <input type="text" class="form-control" id="position" name="position" 
                                   placeholder="Contoh: Frontend Developer, UI/UX Designer">
                        </div>
                    </div>
                    
                    <div class="row">



                        <div class="col-md-6 mb-3">
                            <label class="form-label text-muted fw-medium">
                                <i class="fas fa-map-marker-alt me-1"></i>Lokasi Administrasi
                            </label>



                            <!-- Smart Single Input Field -->
                            <input type="text" class="form-control smart-location-input"
                                   placeholder="Ketik nama kota, kabupaten, atau provinsi..."
                                   required
                                   autocomplete="off"
                                   name="location"
                                   id="location">
                            <small class="form-text text-muted">
                                <i class="fas fa-search me-1"></i>
                                Ketik nama lokasi (minimal 1 huruf) - akan muncul suggestions otomatis
                            </small>


                            <small class="form-text text-muted mt-2">
                                <i class="fas fa-lightbulb me-1"></i>
                                Contoh: "Jakarta", "Bandung", "Jawa Barat", "Surabaya"
                            </small>
                        </div>
                        


                        <div class="col-md-6 mb-3">
                            <label for="application_proof" class="form-label text-muted fw-medium">
                                <i class="fas fa-link me-1"></i>Link Bukti Lamaran
                            </label>
                            <input type="url" class="form-control" id="application_proof" name="application_proof" 
                                   placeholder="URL screenshot atau link bukti lamaran">
                            <small class="form-text text-muted">Contoh: Link LinkedIn, screenshot aplikasi job, dll</small>
                        </div>
                    </div>
                    


                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="source_info" class="form-label text-muted fw-medium">
                                <i class="fas fa-share-alt me-1"></i>Sumber Informasi Loker
                            </label>
                            <select class="form-select" id="source_info" name="source_info" required onchange="toggleCustomSource()">
                                <option value="">Pilih sumber informasi...</option>
                                <option value="LinkedIn"><i class="fab fa-linkedin me-2"></i>LinkedIn</option>
                                <option value="Instagram"><i class="fab fa-instagram me-2"></i>Instagram</option>
                                <option value="TikTok"><i class="fab fa-tiktok me-2"></i>TikTok</option>
                                <option value="WhatsApp"><i class="fab fa-whatsapp me-2"></i>WhatsApp</option>
                                <option value="JobStreet"><i class="fas fa-briefcase me-2"></i>JobStreet</option>
                                <option value="Indeed"><i class="fas fa-search me-2"></i>Indeed</option>
                                <option value="Website Perusahaan"><i class="fas fa-globe me-2"></i>Website Perusahaan</option>
                                <option value="Email/Newsletter"><i class="fas fa-envelope me-2"></i>Email/Newsletter</option>
                                <option value="Teman/Kolega"><i class="fas fa-users me-2"></i>Teman/Kolega</option>
                                <option value="Job Fair/Expo"><i class="fas fa-calendar-alt me-2"></i>Job Fair/Expo</option>
                                <option value="Media Sosial Lainnya"><i class="fas fa-share-alt me-2"></i>Media Sosial Lainnya</option>
                                <option value="Custom"><i class="fas fa-edit me-2"></i>Custom (Input Manual)</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3" id="custom_source_div" style="display: none;">
                            <label for="custom_source" class="form-label text-muted fw-medium">
                                <i class="fas fa-pencil-alt me-1"></i>Sumber Informasi Custom
                            </label>
                            <input type="text" class="form-control" id="custom_source" name="custom_source" 
                                   placeholder="Masukkan sumber informasi...">
                        </div>
                        

                        <div class="col-md-6 mb-3">
                            <label for="applied_date" class="form-label text-muted fw-medium">
                                <i class="fas fa-calendar me-1"></i>Tanggal Apply
                            </label>
                            <input type="date" class="form-control" id="applied_date" name="applied_date" 
                                   value="">
                            <small class="form-text text-muted">Kosongkan untuk menggunakan tanggal hari ini</small>
                            <script>
                                // Set default date to today
                                document.addEventListener('DOMContentLoaded', function() {
                                    const dateInput = document.getElementById('applied_date');
                                    const today = new Date();
                                    const year = today.getFullYear();
                                    const month = String(today.getMonth() + 1).padStart(2, '0');
                                    const day = String(today.getDate()).padStart(2, '0');
                                    dateInput.value = `${year}-${month}-${day}`;
                                });
                            </script>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label text-muted fw-medium">
                            <i class="fas fa-image me-1"></i>Upload Screenshot Bukti
                        </label>
                        <div class="upload-area" id="uploadArea">
                            <input type="file" class="form-control d-none" id="image_proof" name="image_proof" 
                                   accept="image/png,image/jpeg,image/jpg,image/gif" onchange="handleFileSelect(this)">
                            <div class="upload-content text-center">
                                <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                <h6 class="text-muted">Klik untuk upload atau drag & drop gambar</h6>
                                <p class="small text-muted mb-0">Format: PNG, JPG, JPEG, GIF (Max 16MB)</p>
                            </div>
                        </div>
                        <div id="previewArea" class="mt-3 d-none">
                            <div class="d-flex align-items-center">
                                <img id="previewImage" class="img-thumbnail me-3" style="max-width: 100px; max-height: 100px;">
                                <div>
                                    <p class="mb-1" id="previewFileName"></p>
                                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeImage()">
                                        <i class="fas fa-trash me-1"></i>Hapus
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="address" class="form-label text-muted fw-medium">
                            <i class="fas fa-map-pin me-1"></i>Alamat Lengkap
                        </label>
                        <textarea class="form-control" id="address" name="address" rows="3" 
                                  placeholder="Masukkan alamat lengkap perusahaan" required></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label for="status_id" class="form-label text-muted fw-medium">
                            <i class="fas fa-flag me-1"></i>Status Lamaran
                        </label>

                        <select class="form-select" id="status_id" name="status_id" required>
                            <option value="">Pilih status lamaran...</option>
                            {% for status in statuses %}
                            <option value="{{ status.id }}">{{ status.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary flex-fill">
                            <i class="fas fa-save me-2"></i>Simpan Lamaran
                        </button>
                        <a href="/" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-2"></i>Batal
                        </a>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Tips Card -->
        <div class="card border-0 shadow-sm mt-4">
            <div class="card-body">
                <h6 class="fw-bold text-muted mb-3">
                    <i class="fas fa-lightbulb me-2 text-warning"></i>
                    Tips填写 Lamaran
                </h6>
                <div class="row">
                    <div class="col-md-4">
                        <div class="text-center">
                            <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                            <h6 class="fw-bold">Lengkap</h6>
                            <p class="small text-muted mb-0">Pastikan semua informasi perusahaan diisi dengan lengkap</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <i class="fas fa-clock fa-2x text-info mb-2"></i>
                            <h6 class="fw-bold">Tracking</h6>
                            <p class="small text-muted mb-0">Update status secara berkala untuk monitoring yang efektif</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <i class="fas fa-star fa-2x text-warning mb-2"></i>
                            <h6 class="fw-bold">Profesional</h6>
                            <p class="small text-muted mb-0">Maintain data yang rapi dan terorganisir dengan baik</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>



<script>
// Update location field functionality
function updateLocationField(value) {
    const hiddenLocationField = document.querySelector('.location-input');
    if (hiddenLocationField) {
        hiddenLocationField.value = value;
    }
}

// Custom source toggle functionality
function toggleCustomSource() {
    const sourceSelect = document.getElementById('source_info');
    const customDiv = document.getElementById('custom_source_div');
    const customInput = document.getElementById('custom_source');
    
    if (sourceSelect.value === 'Custom') {
        customDiv.style.display = 'block';
        customInput.required = true;
    } else {
        customDiv.style.display = 'none';
        customInput.required = false;
        customInput.value = ''; // Clear custom input when switching away
    }
}

// File upload functionality
function handleFileSelect(input) {
    const file = input.files[0];
    if (file) {
        showPreview(file);
    }
}

function showPreview(file) {
    const previewArea = document.getElementById('previewArea');
    const previewImage = document.getElementById('previewImage');
    const previewFileName = document.getElementById('previewFileName');
    
    // Create object URL for preview
    const objectUrl = URL.createObjectURL(file);
    previewImage.src = objectUrl;
    previewFileName.textContent = file.name + ' (' + formatFileSize(file.size) + ')';
    
    previewArea.classList.remove('d-none');
    document.getElementById('uploadArea').style.display = 'none';
}

function removeImage() {
    const previewArea = document.getElementById('previewArea');
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('image_proof');
    
    previewArea.classList.add('d-none');
    uploadArea.style.display = 'block';
    fileInput.value = '';
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Drag and drop functionality
document.addEventListener('DOMContentLoaded', function() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('image_proof');
    
    // Click to upload
    uploadArea.addEventListener('click', function() {
        fileInput.click();
    });
    
    // Drag over
    uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    // Drag leave
    uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });
    
    // Drop
    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFileSelect(fileInput);
        }
    });
    
    // Prevent default drag behaviors on document
    document.addEventListener('dragover', function(e) {
        e.preventDefault();
    });
    
    document.addEventListener('drop', function(e) {
        e.preventDefault();
    });
});
</script>
{% endblock %}
